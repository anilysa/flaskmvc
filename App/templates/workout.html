<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="{{ url_for('static', filename='workout.css') }}">
    <title>Add Workout</title>
  </head>
  <body>
    <nav class="bar">
      <div class="nav-wrapper">
        <a href="#!" class="brand-logo center">{% block page %}{% endblock %}</a>
        <ul id="nav-mobile" class="left">
          <li><a href="/temp">Home</a></li>
          <li><a href="/workout">workouts</a></li>
          <li><a href="/routine">workout routine</a></li>
          <li><a href="/logout">Logout</a></li>
          <li><a href="/login">login</a></li>
          <li><a href="/view">routine view</a></li>
        </ul>
      </div>
    
    <h1>Add Workout</h1>
    <div>
      <input type="text" id="searchInput" placeholder="Search for an exercise...">
      <button onclick="searchExercises()">Search</button>
    </div>
    <div id="exercise-container" class="workout-container"></div>
</nav>

    <script>
      // Function to fetch workouts from the API for a given muscle group
      function fetchWorkoutsByMuscle(muscle) {
        var api_url = 'https://api.api-ninjas.com/v1/exercises?muscle=' + muscle;
        return fetch(api_url, {
          headers: {
            'X-Api-Key': 'MNTs3LU671IWeM9bxMaF0A==thhK8SBpIUrdU0y4'
          }
        }).then(response => response.json());
      }

      // Function to fetch workouts from the API for all muscle groups
      function fetchAllWorkouts() {
        var muscleGroups = ['abdominals', 'abductors', 'adductors', 'biceps', 'calves', 'chest', 'forearms', 'glutes', 'hamstrings', 'lats', 'lower_back', 'middle_back', 'neck', 'quadriceps', 'traps', 'triceps'];
        var apiPromises = muscleGroups.map(fetchWorkoutsByMuscle);

        return Promise.all(apiPromises)
          .then(responses => {
            // Flatten the array of responses into a single array of workouts
            return responses.reduce((acc, curr) => acc.concat(curr), []);
          });
      }

      // Function to create exercise cards
      function createExerciseCard(exercise) {
        var card = document.createElement('div');
        card.classList.add('workout-card');

        var muscleGroup = document.createElement('div');
        muscleGroup.classList.add('muscle-group');
        muscleGroup.textContent = 'Muscle Group: ' + exercise.muscle;

        var exerciseName = document.createElement('div');
        exerciseName.classList.add('exercise');
        exerciseName.textContent = 'Exercise Name: ' + exercise.name;

        var exerciseType = document.createElement('div');
        exerciseType.textContent = 'Type: ' + exercise.type;

        var equipment = document.createElement('div');
        equipment.textContent = 'Equipment: ' + exercise.equipment;

        var difficulty = document.createElement('div');
        difficulty.textContent = 'Difficulty: ' + exercise.difficulty;

        var addButton = document.createElement('button');
        addButton.classList.add('add-button');
        addButton.textContent = 'Add to Routine';

        // Add event listener to the "Add to Routine" button
        addButton.addEventListener('click', function() {
          addToRoutine(exercise);
        });

        card.appendChild(muscleGroup);
        card.appendChild(exerciseName);
        card.appendChild(exerciseType);
        card.appendChild(equipment);
        card.appendChild(difficulty);
        card.appendChild(addButton);

        return card;
      }

      // Function to display exercises on the page
      function displayExercises(exercises) {
        var exerciseContainer = document.getElementById('exercise-container');
        exercises.forEach(exercise => {
          var card = createExerciseCard(exercise);
          exerciseContainer.appendChild(card);
        });
      }

      // Function to filter exercises based on search input
      function searchExercises() {
        var searchInput = document.getElementById('searchInput').value.toLowerCase();
        var exerciseContainer = document.getElementById('exercise-container');
        var exerciseCards = exerciseContainer.getElementsByClassName('workout-card');

        Array.from(exerciseCards).forEach(card => {
          var exerciseName = card.getElementsByClassName('exercise')[0].textContent.toLowerCase();
          if (exerciseName.includes(searchInput)) {
            card.style.display = 'block';
          } else {
            card.style.display = 'none';
          }
        });
      }

      function addToRoutine(exercise) {
  // Construct the URL with query parameters
  var url = 'routine.html?exerciseName=' + encodeURIComponent(exercise.name) +
            '&muscleGroup=' + encodeURIComponent(exercise.muscle) +
            '&type=' + encodeURIComponent(exercise.type) +
            '&equipment=' + encodeURIComponent(exercise.equipment) +
            '&difficulty=' + encodeURIComponent(exercise.difficulty);

  // Redirect to the routine page with the data
  window.location.href = url;
}


      // Fetch all workouts when the page loads
      window.onload = function() {
        fetchAllWorkouts()
          .then(exercises => {
            displayExercises(exercises);
          })
          .catch(error => {
            console.error('Error fetching exercises:', error);
          });
      };
    </script>
  </body>
</html>
