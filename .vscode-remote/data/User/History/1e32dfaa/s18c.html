{% extends "layout.html" %}
{% block title %}Workout App{% endblock %}
{% block page %}Workout App{% endblock %}

{% block content %}
    <!-- Featured Workouts -->
    <section class="featured-workouts">
        <h2>Featured Workouts</h2>

        <!-- Search Bar -->
        <form class="navbar-form" onsubmit="searchExercises(); return false;">
            <input type="text" id="search-input" placeholder="Search for exercises...">
            <button type="submit">Search</button>
        </form>

        <div id="workouts-list" class="workout-card">
            <!-- Displayed after filtering -->
            {% for exercise in exercises %}
                <div class="exercise-card" id="exercise{{ loop.index }}">
                    <h3>{{ exercise['Title'] }}</h3>
                    <p>Description: {{ exercise['Desc'] }}</p>
                    <p>Type: {{ exercise['Type'] }}</p>
                    <p>Body Part: {{ exercise['BodyPart'] }}</p>
                    <p>Equipment: {{ exercise['Equipment'] }}</p>
                    <p>Level: {{ exercise['Level'] }}</p>
                    <p>Rating: {{ exercise['Rating'] }}</p>
                    <p>Rating Description: {{ exercise['RatingDesc'] }}</p>
                </div>
            {% endfor %}
        </div>
    </section>

    <script>
        function searchExercises() {
            var query = document.getElementById('search-input').value.trim().toLowerCase();

            fetch('dataset.csv')
                .then(response => response.text())
                .then(csvData => {
                    const exercises = parseCSV(csvData);
                    const filteredExercises = exercises.filter(exercise =>
                        Object.values(exercise).some(value =>
                            value.toLowerCase().includes(query) // Check if value contains search query
                        )
                    );
                    displayExercises(filteredExercises);
                })
                .catch(error => console.error('Error fetching CSV:', error));
        }

        function parseCSV(csv) {
            const lines = csv.split('\n');
            const headers = lines[0].split(',');
            const data = [];
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',');
                const exercise = {};
                for (let j = 0; j < headers.length; j++) {
                    exercise[headers[j]] = values[j];
                }
                data.push(exercise);
            }
            return data;
        }

        function displayExercises(exercises) {
            const workoutsList = document.getElementById('workouts-list');
            workoutsList.innerHTML = '';

            if (exercises.length > 0) {
                exercises.forEach(exercise => {
                    const exerciseCard = document.createElement('div');
                    exerciseCard.classList.add('exercise-card');
                    exerciseCard.innerHTML = `
                        <h3>${exercise['Title']}</h3>
                        <p>Description: ${exercise['Desc']}</p>
                        <p>Type: ${exercise['Type']}</p>
                        <p>Body Part: ${exercise['BodyPart']}</p>
                        <p>Equipment: ${exercise['Equipment']}</p>
                        <p>Level: ${exercise['Level']}</p>
                        <p>Rating: ${exercise['Rating']}</p>
                        <p>Rating Description: ${exercise['RatingDesc']}</p>
                    `;
                    workoutsList.appendChild(exerciseCard);
                });
            } else {
                workoutsList.innerHTML = '<p>No exercises found.</p>';
            }
        }
    </script>
{% endblock %}
