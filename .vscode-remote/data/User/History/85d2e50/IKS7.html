{% extends "layout.html" %}
{% block title %}Weekly Workout Routine{% endblock %}
{% block page %}Weekly Workout Routine{% endblock %}

{% block content %}
    <header>
        <h1 style="color: white;">Workout App
            <img src="https://www.vectorkhazana.com/assets/images/products/Dumbbell_Svg.png">
        </h1>
        <nav class="navbar">
            <div class="navbar-links">
                <a href="/temp">Home</a>
                <a href="/routine">Workout Routine</a>
                <a href="/view">Routine View</a>
                <a href="/">Logout</a>
            </div>
        </nav>
    </header>

    <h1>Weekly Workout Routine</h1>

    <div class="bar">
        <!-- Monday -->
        <div class="workout-card" id="monday">
            <h2>Monday</h2>
            <label for="monday-muscle-groups">Muscle Groups:</label>
            <select id="monday-muscle-groups">
                {% for muscle in muscles %}
                    <option value="{{ muscle }}">{{ muscle|capitalize }}</option>
                {% endfor %}
            </select>
            <button onclick="fetchAndDisplay('monday')">Fetch Workouts</button>
            <button onclick="toggleExerciseList('monday')">Close Exercises</button>
            <div class="exercise-list" id="monday-exercises"></div> <!-- Display fetched exercises here -->
            <ul id="monday-routine-list"></ul> <!-- List to add exercises -->
        </div>

        <!-- Repeat for other days of the week -->
        <!-- Tuesday, Wednesday, Thursday, Friday, Saturday, Sunday -->

    </div>

    <div class="save-button-container">
        <button onclick="saveRoutine()" class="save-button">Save Routine</button>
    </div>

    <script>
        // Function to toggle exercise list visibility
        function toggleExerciseList(day) {
            var exerciseList = document.getElementById(day + "-exercises");
            if (exerciseList.style.display === "none") {
                exerciseList.style.display = "block";
            } else {
                exerciseList.style.display = "none";
            }
        }

        // Function to fetch workouts from the CSV data
        function fetchWorkoutsByMuscle(muscle) {
            var api_url = 'https://api.api-ninjas.com/v1/exercises?muscle=' + muscle;
            return fetch(api_url, {
                headers: {
                    'X-Api-Key': 'MNTs3LU671IWeM9bxMaF0A==thhK8SBpIUrdU0y4'
                }
            }).then(response => response.json());
        }

        // Function to fetch and display workouts for a specific day
        function fetchAndDisplay(day) {
            var muscle = document.getElementById(day + "-muscle-groups").value;
            var container = document.getElementById(day + "-exercises");
            container.innerHTML = ""; // Clear previous exercises
            fetchWorkoutsByMuscle(muscle)
                .then(exercises => {
                    exercises.forEach(exercise => {
                        var exerciseElement = document.createElement("div");
                        var exerciseName = document.createElement("span");
                        exerciseName.textContent = exercise.name;
                        var addButton = document.createElement("button");
                        addButton.textContent = "Add";
                        addButton.addEventListener("click", function() {
                            addExerciseToRoutine(exercise.name, day);
                        });
                        exerciseElement.appendChild(exerciseName);
                        exerciseElement.appendChild(addButton);
                        container.appendChild(exerciseElement);
                    });
                })
                .catch(error => {
                    console.error('Error fetching exercises:', error);
                });
        }

        // Function to add exercise to routine list
        function addExerciseToRoutine(exerciseName, day) {
            var routineList = document.getElementById(day + "-routine-list");
            var exerciseListItem = document.createElement("li");
            exerciseListItem.textContent = exerciseName;
            routineList.appendChild(exerciseListItem);
        }

        // Function to save the routine to localStorage and redirect to routineview.html
        function saveRoutine() {
            var allDays = ["monday", "tuesday", "wednesday", "thursday", "friday", "saturday", "sunday"];
            var allExercises = {};
            allDays.forEach(day => {
                var routineList = document.getElementById(day + "-routine-list");
                var exercises = [];
                routineList.childNodes.forEach(node => {
                    if (node.nodeName === "LI") {
                        exercises.push(node.textContent);
                    }
                });
                allExercises[day] = exercises;
            });
            localStorage.setItem("routine", JSON.stringify(allExercises));
            // window.location.href = "routineview.html";
        }
    </script>

{% endblock %}
